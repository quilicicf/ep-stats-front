<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Empires & Puzzles - Stats</title>
  <link rel="icon" type="image/png" href="/assets/icon.png">
  <link rel="stylesheet" href="app.css" />
  <script src="app.js"></script>
</head>

<body>

<div id="elm"></div>
<script>
  const STATE_KEY = 'state';
  const COPY_TO_CLIPBOARD_ATTRIBUTE = 'data-copy-to-clipboard';

  const storedState = localStorage.getItem(STATE_KEY);
  const startingState = storedState ? JSON.parse(storedState) : null;
  const navigatorLanguage = navigator.language;

  const app = Elm.Main.init({
    flags: { ...startingState, navigatorLanguage },
    node: document.getElementById('elm'),
  });

  app.ports.setStorage.subscribe((state) => {
    localStorage.setItem(STATE_KEY, JSON.stringify(state));
  });

  window.onload = () => {
    document.addEventListener('click', ({ target }) => {
      if (target.hasAttribute(COPY_TO_CLIPBOARD_ATTRIBUTE)) {
        const selectorToElement = target.getAttribute(COPY_TO_CLIPBOARD_ATTRIBUTE);
        const element = document.querySelector(selectorToElement);

        if (element) {
          element.select();
          document.execCommand('copy');
        }
      }
    });
  };
</script>
</body>
</html>
